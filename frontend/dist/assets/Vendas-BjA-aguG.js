import{_ as x,o as r,h as B,w as d,c as u,a as n,i as _,j as b,k as S,l as q,T as E,t as m,m as z,b as f,p as c,r as g,B as j,q as A,s as C,v as w,F as k,u as P,x as D,f as v,y as M}from"./index-N_QlHFU0.js";import{C as F}from"./CustomSelect-C3UNst7j.js";const I={name:"BaseModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:""}},emits:["update:show","close"],watch:{show(t){t?(this.$nextTick(()=>{this.focusDialog()}),document.body.style.overflow="hidden"):document.body.style.overflow=""}},mounted(){this.show&&this.focusDialog()},beforeUnmount(){document.body.style.overflow=""},methods:{close(){this.$emit("update:show",!1),this.$emit("close")},onEsc(t){this.show&&this.close()},focusDialog(){this.$refs.dialog?.focus()},trapFocus(t){const e=this.$refs.dialog?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!e?.length)return;const o=e[0],p=e[e.length-1];document.activeElement===p?o.focus():p.focus()}}},Q=["aria-label"],N={key:0,class:"flex items-center justify-between mb-4"},K={class:"text-lg font-semibold"},L={key:1,class:"mt-4"};function O(t,e,o,p,l,a){return r(),B(E,{name:"modal-fade"},{default:d(()=>[o.show?(r(),u("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center",onKeydown:e[3]||(e[3]=S((...i)=>a.onEsc&&a.onEsc(...i),["esc"])),tabindex:"-1",ref:"modalRoot"},[n("div",{class:"absolute inset-0 bg-black/40",onClick:e[0]||(e[0]=(...i)=>a.close&&a.close(...i)),"aria-hidden":"true"}),n("div",{class:"bg-white dark:bg-slate-800 rounded-lg shadow-lg z-10 w-full max-w-2xl w-full p-4 outline-none",role:"dialog","aria-modal":"true","aria-label":o.title||void 0,ref:"dialog",onKeydown:e[2]||(e[2]=S(q((...i)=>a.trapFocus&&a.trapFocus(...i),["prevent"]),["tab"]))},[t.$slots.header||o.title?(r(),u("header",N,[_(t.$slots,"header",{},()=>[n("h3",K,m(o.title),1)],!0),n("button",{onClick:e[1]||(e[1]=(...i)=>a.close&&a.close(...i)),"aria-label":"Fechar",class:"ml-2 text-xl"},"✕")])):b("",!0),n("section",null,[_(t.$slots,"default",{},void 0,!0)]),t.$slots.footer?(r(),u("footer",L,[_(t.$slots,"footer",{},void 0,!0)])):b("",!0)],40,Q)],544)):b("",!0)]),_:3})}const R=x(I,[["render",O],["__scopeId","data-v-54fed7ca"]]),G={name:"BaseButton",props:{variant:{type:String,default:"primary"},size:{type:String,default:"md"},disabled:{type:Boolean,default:!1}},computed:{variantClass(){return this.variant==="primary"?"btn-primary":this.variant==="secondary"?"btn-secondary":this.variant==="ghost"?"bg-transparent":"btn-primary"},sizeClass(){return this.size==="sm"?"px-3 py-1 text-sm":this.size==="lg"?"px-5 py-2 text-base":"px-4 py-2 text-sm"}}},H=["disabled"];function J(t,e,o,p,l,a){return r(),u("button",{class:z(["inline-flex items-center justify-center gap-2",a.variantClass,a.sizeClass,{"opacity-50 cursor-not-allowed":o.disabled}]),disabled:o.disabled,onClick:e[0]||(e[0]=i=>t.$emit("click"))},[_(t.$slots,"default")],10,H)}const W=x(G,[["render",J]]),X={name:"ConfirmDialog",components:{BaseModal:R,BaseButton:W},props:{modelValue:{type:Boolean,default:!1},title:{type:String,default:"Confirmação"},message:{type:String,default:""}},emits:["update:modelValue","confirm","cancel"],computed:{visible:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}}},methods:{confirm(){this.$emit("confirm"),this.visible=!1},cancel(){this.$emit("cancel"),this.visible=!1},onClose(){this.visible=!1}}},Y={class:"p-2"},Z={class:"mt-4 flex justify-end gap-2"};function $(t,e,o,p,l,a){const i=g("BaseButton"),V=g("BaseModal");return r(),B(V,{show:a.visible,title:o.title,"onUpdate:show":a.onClose},{default:d(()=>[n("div",Y,[n("p",null,m(o.message),1),n("div",Z,[f(i,{variant:"secondary",onClick:a.cancel},{default:d(()=>[...e[0]||(e[0]=[c("Cancelar",-1)])]),_:1},8,["onClick"]),f(i,{variant:"primary",onClick:a.confirm},{default:d(()=>[...e[1]||(e[1]=[c("Confirmar",-1)])]),_:1},8,["onClick"])])])]),_:1},8,["show","title","onUpdate:show"])}const ee=x(X,[["render",$]]),te={components:{BaseTable:A,BaseButton:j,ConfirmDialog:ee,CustomSelect:F},data(){return{vendas:[],loading:!1,query:"",novaVenda:{cliente_id:null,items:[{produto_id:null,quantidade:1,valor_unitario:null}]},tableCols:[{key:"cliente",label:"Cliente"},{key:"produto",label:"Produto"},{key:"quantidade",label:"Quantidade"},{key:"valor_unitario",label:"Valor Unit."},{key:"status",label:"Status"},{key:"acoes",label:"Ações"}],totalCount:0,clients:[],products:[],showCreateModal:!1,confirmPayload:null,confirming:!1,pageSize:25,currentPage:1,timer:null}},computed:{productOptions(){return[{value:"",label:"Selecione um produto"},...this.products.map(t=>({value:t.id,label:t.nome}))]},visibleVendas(){return(this.vendas||[]).filter(t=>{if(!t)return!1;const e=t.cliente&&String(t.cliente).trim().length>0,o=t.produto&&String(t.produto).trim().length>0,p=t.status&&String(t.status).trim().length>0,l=t.quantidade!==void 0&&t.quantidade!==null,a=t.valor_unitario!==void 0&&t.valor_unitario!==null;return e||o||p||l||a})},totalPages(){return Math.max(1,Math.ceil(this.totalCount/this.pageSize))},paginatedVendas(){return this.visibleVendas}},methods:{async loadVendas(){this.loading=!0;try{const t=await v.get("/api/v1/vendas",{params:{q:this.query,page:this.currentPage,per_page:this.pageSize}});this.vendas=t.data.items||[],this.totalCount=t.data.total||0}catch(t){console.error("Erro ao carregar vendas:",t),this.vendas=[],this.totalCount=0}finally{this.loading=!1}},async loadClients(){try{const t=await v.get("/api/v1/clientes");this.clients=t.data||[]}catch{this.clients=[]}},async loadProducts(){try{const t=await v.get("/api/v1/produtos",{params:{per_page:100}});this.products=t.data.items||[]}catch{this.products=[]}},goToPage(t){this.currentPage=Math.min(Math.max(1,t),this.totalPages),this.loadVendas()},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadVendas())},prevPage(){this.currentPage>1&&(this.currentPage--,this.loadVendas())},openConfirm(t){this.confirmPayload=t,this.confirming=!0},cancelConfirm(){this.confirming=!1,this.confirmPayload=null},async confirmUpdate(){const t=this.confirmPayload;this.confirming=!1;try{await v.patch(`/api/v1/vendas/${t}`,{status:"entregue"}),M().notify("Pedido marcado como entregue",{type:"success"}),this.loadVendas()}catch(e){console.error("Erro ao atualizar status:",e),M().notify("Falha ao atualizar status",{type:"error"})}},async createSale(){try{if(!this.novaVenda.cliente_id)throw new Error("Cliente obrigatório");const t=(this.novaVenda.items||[]).filter(o=>o&&o.produto_id);if(t.length===0)throw new Error("Adicione pelo menos um produto");const e={cliente_id:this.novaVenda.cliente_id,items:t.map(o=>({produto_id:o.produto_id,quantidade:o.quantidade||1,valor_unitario:o.valor_unitario||0}))};await v.post("/api/v1/vendas",e),this.novaVenda={cliente_id:null,items:[{produto_id:null,quantidade:1,valor_unitario:null}]},this.showCreateModal=!1,this.loadVendas()}catch(t){console.error("Erro ao criar venda:",t)}},onProductChange(t){const e=this.novaVenda.items[t].produto_id,o=this.products.find(p=>p.id===e);o?this.novaVenda.items[t].valor_unitario=o.custo_medio||o.custo||null:this.novaVenda.items[t].valor_unitario=null},openCreateModal(){this.showCreateModal=!0},closeCreateModal(){this.showCreateModal=!1,this.novaVenda={cliente_id:null,items:[{produto_id:null,quantidade:1,valor_unitario:null}]}},addItem(){this.novaVenda.items.push({produto_id:null,quantidade:1,valor_unitario:null})},removeItem(t){this.novaVenda.items.length>1&&this.novaVenda.items.splice(t,1)},refresh(){this.loadVendas()},onQuery(){clearTimeout(this.timer),this.timer=setTimeout(()=>this.loadVendas(),350)}},mounted(){this.loadClients(),this.loadProducts(),this.loadVendas()}},ae={class:"page-fade"},se={class:"flex items-center justify-between mb-6"},ne={class:"flex items-center gap-3"},oe={key:0,class:"panel-inner"},le={key:1,class:"text-sm muted"},ie={key:1,class:"py-12 text-center"},re={class:"flex justify-center"},de={key:0,class:"mt-4"},ue={class:"panel-inner flex items-center justify-between"},ce={class:"text-sm muted"},me={class:"flex items-center gap-2"},fe=["onClick"],pe={key:1,class:"fixed inset-0 z-40 flex items-center justify-center"},he={class:"bg-white rounded-2xl shadow-md z-50 w-full max-w-3xl p-10 md:p-12"},ge=["value"],ye={class:"space-y-2"},ve={class:"col-span-6"},be={class:"col-span-2"},Ce=["onUpdate:modelValue"],_e={class:"col-span-3"},xe=["onUpdate:modelValue"],Ve={class:"col-span-1"},we=["onClick"],ke={class:"flex justify-end gap-3 mt-4"};function Pe(t,e,o,p,l,a){const i=g("BaseButton"),V=g("BaseTable"),U=g("ConfirmDialog"),T=g("CustomSelect");return r(),u("div",ae,[n("div",se,[e[8]||(e[8]=n("div",null,[n("h2",{class:"text-2xl font-semibold text-gray-800"},"Vendas"),n("p",{class:"mt-2 text-sm text-gray-500"},"Gerencie suas vendas e pedidos")],-1)),n("div",ne,[C(n("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.query=s),onInput:e[1]||(e[1]=(...s)=>a.onQuery&&a.onQuery(...s)),placeholder:"Buscar por cliente ou produto",class:"p-3 border border-gray-300 rounded-xl w-full max-w-md"},null,544),[[w,l.query]]),f(i,{class:"btn-secondary",onClick:a.refresh},{default:d(()=>[...e[6]||(e[6]=[c("Atualizar",-1)])]),_:1},8,["onClick"]),f(i,{class:"btn-primary ml-2 whitespace-nowrap",onClick:a.openCreateModal},{default:d(()=>[...e[7]||(e[7]=[c("Adicionar Venda",-1)])]),_:1},8,["onClick"])])]),n("div",null,[l.loading||a.visibleVendas.length>0?(r(),u("div",oe,[f(V,{columns:l.tableCols,rows:a.paginatedVendas},{cliente:d(({row:s})=>[c(m(s.cliente),1)]),produto:d(({row:s})=>[c(m(s.produto),1)]),quantidade:d(({row:s})=>[c(m(s.quantidade),1)]),valor_unitario:d(({row:s})=>[c(m(s.valor_unitario!==void 0&&s.valor_unitario!==null?"R$ "+s.valor_unitario:"-"),1)]),status:d(({row:s})=>[c(m(s.status||"-"),1)]),acoes:d(({row:s})=>[n("div",null,[s.status&&String(s.status).toLowerCase()==="entregue"?(r(),u("span",le,"Entregue")):(r(),B(i,{key:0,variant:"primary",onClick:y=>a.openConfirm(s.id)},{default:d(()=>[...e[9]||(e[9]=[c("Entregar",-1)])]),_:1},8,["onClick"]))])]),_:1},8,["columns","rows"])])):(r(),u("div",ie,[e[11]||(e[11]=n("p",{class:"text-lg font-medium mb-4 text-gray-800"},"Nenhuma venda encontrada.",-1)),e[12]||(e[12]=n("p",{class:"text-sm muted mb-6"},"Você ainda não registrou vendas. Clique abaixo para adicionar a primeira venda.",-1)),n("div",re,[f(i,{class:"btn-primary whitespace-nowrap",onClick:a.openCreateModal},{default:d(()=>[...e[10]||(e[10]=[c("Adicionar Venda",-1)])]),_:1},8,["onClick"])])]))]),a.visibleVendas.length>0?(r(),u("div",de,[n("div",ue,[n("div",ce,"Mostrando "+m((l.currentPage-1)*l.pageSize+1)+" - "+m(Math.min(l.currentPage*l.pageSize,l.totalCount))+" de "+m(l.totalCount),1),n("div",me,[f(i,{class:"btn-secondary",disabled:l.currentPage<=1,onClick:a.prevPage},{default:d(()=>[...e[13]||(e[13]=[c("Anterior",-1)])]),_:1},8,["disabled","onClick"]),(r(!0),u(k,null,P(Math.min(5,a.totalPages),s=>(r(),u("button",{key:s,class:z(["px-3 py-1 rounded text-sm",{"bg-gray-200":l.currentPage===s}]),onClick:y=>a.goToPage(s)},m(s),11,fe))),128)),f(i,{class:"btn-secondary",disabled:l.currentPage>=a.totalPages,onClick:a.nextPage},{default:d(()=>[...e[14]||(e[14]=[c("Próximo",-1)])]),_:1},8,["disabled","onClick"])])])])):b("",!0),f(U,{modelValue:l.confirming,title:"Confirmar entrega",message:"Deseja marcar este pedido como entregue?",onConfirm:a.confirmUpdate,onCancel:a.cancelConfirm},null,8,["modelValue","onConfirm","onCancel"]),l.showCreateModal?(r(),u("div",pe,[n("div",{class:"fixed inset-0 bg-black/40",onClick:e[2]||(e[2]=(...s)=>a.closeCreateModal&&a.closeCreateModal(...s)),"aria-hidden":"true"}),n("div",he,[e[22]||(e[22]=n("h3",{class:"text-xl font-semibold mb-4 text-gray-800"},"Adicionar Venda",-1)),n("form",{onSubmit:e[5]||(e[5]=q((...s)=>a.createSale&&a.createSale(...s),["prevent"])),class:"grid grid-cols-1 gap-3"},[e[21]||(e[21]=n("label",{class:"text-sm text-gray-600"},"Cliente",-1)),C(n("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.novaVenda.cliente_id=s),required:"",class:"p-3 border border-gray-300 rounded-xl estilo-select"},[e[15]||(e[15]=n("option",{value:"",disabled:""},"Selecione um cliente",-1)),(r(!0),u(k,null,P(l.clients,s=>(r(),u("option",{key:s.id,value:s.id},m(s.nome),9,ge))),128))],512),[[D,l.novaVenda.cliente_id]]),n("div",ye,[(r(!0),u(k,null,P(l.novaVenda.items,(s,y)=>(r(),u("div",{key:y,class:"grid grid-cols-12 gap-2 items-end"},[n("div",ve,[e[16]||(e[16]=n("label",{class:"text-sm text-gray-600"},"Produto",-1)),f(T,{modelValue:s.produto_id,"onUpdate:modelValue":[h=>s.produto_id=h,h=>a.onProductChange(y)],options:a.productOptions,placeholder:"Selecione um produto",class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options"])]),n("div",be,[e[17]||(e[17]=n("label",{class:"text-sm text-gray-600"},"Qtd",-1)),C(n("input",{"onUpdate:modelValue":h=>s.quantidade=h,type:"number",placeholder:"Qtd",class:"p-3 border border-gray-300 rounded-xl w-full",min:"1",required:""},null,8,Ce),[[w,s.quantidade,void 0,{number:!0}]])]),n("div",_e,[e[18]||(e[18]=n("label",{class:"text-sm text-gray-600"},"Valor Unit.",-1)),C(n("input",{"onUpdate:modelValue":h=>s.valor_unitario=h,type:"number",placeholder:"Valor Unitário",class:"p-3 border border-gray-300 rounded-xl w-full",step:"0.01",required:""},null,8,xe),[[w,s.valor_unitario,void 0,{number:!0}]])]),n("div",Ve,[n("button",{type:"button",class:"btn-secondary w-full",onClick:h=>a.removeItem(y)},"-",8,we)])]))),128)),n("div",null,[n("button",{type:"button",class:"btn-secondary",onClick:e[4]||(e[4]=(...s)=>a.addItem&&a.addItem(...s))},"+ Adicionar produto")])]),n("div",ke,[f(i,{type:"button",class:"btn-secondary",onClick:a.closeCreateModal},{default:d(()=>[...e[19]||(e[19]=[c("Cancelar",-1)])]),_:1},8,["onClick"]),f(i,{type:"submit",class:"btn-primary whitespace-nowrap"},{default:d(()=>[...e[20]||(e[20]=[c("Adicionar Venda",-1)])]),_:1})])],32)])])):b("",!0)])}const Me=x(te,[["render",Pe]]);export{Me as default};

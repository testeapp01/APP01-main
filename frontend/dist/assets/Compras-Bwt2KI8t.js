import{_ as P,q as M,B as q,o as i,c as a,a as t,b as p,w as m,p as n,t as l,j as u,F as x,u as C,m as v,l as V,s as c,x as f,v as y,f as _,r as k}from"./index-N_QlHFU0.js";const F={components:{BaseButton:q,BaseTable:M},data(){return{compras:[],fornecedores:[],produtos:[],motoristas:[],clientes:[],novaCompra:{tipo:"revenda",fornecedor_id:null,cliente_id:null,produto_id:null,motorista_id:null,comissao_intermediador:null,comissao_motorista:null,comissao_intermediador_em_dinheiro:!0,comissao_motorista_em_dinheiro:!0,quantidade:0,valor_unitario:0},loading:!1,showCreateModal:!1,pageSize:25,currentPage:1,totalCount:0}},mounted(){this.loadCompras(),this.loadFornecedores(),this.loadProdutos(),this.loadMotoristas(),this.loadClientes()},computed:{tableCols(){return[{key:"fornecedor",label:"Fornecedor"},{key:"produto",label:"Produto"},{key:"quantidade",label:"Quantidade"},{key:"valor_unitario",label:"Valor Unit."},{key:"status",label:"Status"}]},visibleCompras(){return(this.compras||[]).filter(r=>{if(!r)return!1;const o=r.fornecedor&&String(r.fornecedor).trim().length>0,g=r.produto&&String(r.produto).trim().length>0,h=r.quantidade!==void 0&&r.quantidade!==null,e=r.valor_unitario!==void 0&&r.valor_unitario!==null;return o||g||h||e})},totalPages(){return Math.max(1,Math.ceil(this.totalCount/this.pageSize))},paginatedCompras(){return this.visibleCompras}},methods:{async loadCompras(){this.loading=!0;try{const r=await _.get("/api/v1/compras",{params:{page:this.currentPage,per_page:this.pageSize}});this.compras=r.data.items||[],this.totalCount=r.data.total||0}catch(r){console.error("Erro ao carregar compras:",r),this.compras=[],this.totalCount=0}finally{this.loading=!1}},async createPurchase(){try{let r={produto_id:this.novaCompra.produto_id,quantidade:this.novaCompra.quantidade,valor_unitario:this.novaCompra.valor_unitario,fornecedor_id:this.novaCompra.fornecedor_id};this.novaCompra.tipo==="cliente"&&(r={...r,cliente_id:this.novaCompra.cliente_id,motorista_id:this.novaCompra.motorista_id,comissao_intermediador:this.novaCompra.comissao_intermediador,comissao_motorista:this.novaCompra.comissao_motorista,comissao_intermediador_em_dinheiro:this.novaCompra.comissao_intermediador_em_dinheiro,comissao_motorista_em_dinheiro:this.novaCompra.comissao_motorista_em_dinheiro}),await _.post("/api/v1/compras",r),this.novaCompra={tipo:"revenda",fornecedor_id:null,cliente_id:null,produto_id:null,motorista_id:null,comissao_intermediador:null,comissao_motorista:null,comissao_intermediador_em_dinheiro:!0,comissao_motorista_em_dinheiro:!0,quantidade:0,valor_unitario:0},this.showCreateModal=!1,this.loadCompras()}catch(r){console.error("Erro ao criar compra:",r)}},async loadClientes(){try{const r=await _.get("/api/v1/clientes");this.clientes=r.data.items||r.data||[]}catch(r){console.error("Erro ao carregar clientes",r),this.clientes=[]}},async loadFornecedores(){try{const r=await _.get("/api/v1/fornecedores");this.fornecedores=r.data||[]}catch(r){console.error("Erro ao carregar fornecedores",r),this.fornecedores=[]}},async loadProdutos(){try{const r=await _.get("/api/v1/produtos",{params:{page:1,per_page:1e3}});this.produtos=r.data.items||[]}catch(r){console.error("Erro ao carregar produtos",r),this.produtos=[]}},async loadMotoristas(){try{const r=await _.get("/api/v1/motoristas");this.motoristas=r.data||[]}catch(r){console.error("Erro ao carregar motoristas",r),this.motoristas=[]}},onProdutoChange(){const r=this.novaCompra.produto_id,o=this.produtos.find(g=>g.id===r);o&&o.custo_medio!==void 0&&(this.novaCompra.valor_unitario=parseFloat(o.custo_medio))},openCreateModal(){this.showCreateModal=!0},closeCreateModal(){this.showCreateModal=!1,this.novaCompra={fornecedor:"",produto:"",quantidade:0,valor_unitario:0}},prevPage(){this.currentPage>1&&(this.currentPage--,this.loadCompras())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadCompras())},goToPage(r){this.currentPage=Math.min(Math.max(1,r),this.totalPages),this.loadCompras()}}},B={class:"flex items-center justify-between mb-6"},R={class:"flex items-center gap-3"},T={key:0,class:"panel-inner"},E={key:1,class:"py-12 text-center"},S={class:"flex justify-center"},U={key:2,class:"mt-4"},z={class:"panel-inner flex items-center justify-between"},j={class:"text-sm muted"},A={class:"flex items-center gap-2"},N=["onClick"],Q={key:3,class:"fixed inset-0 z-40 flex items-center justify-center"},G={class:"bg-white rounded-2xl shadow-md z-50 w-full max-w-3xl p-10"},D={class:"flex gap-3"},I=["value"],L={key:0},H=["value"],J=["value"],K={key:1},O=["value"],W={class:"flex flex-row gap-6 items-start w-full mb-4"},X={class:"flex-1"},Y={class:"flex-1"},Z={key:2,class:"flex flex-row justify-center gap-6 w-full mb-2"},$={class:"bg-gray-50 rounded-2xl p-4 border-2 border-blue-300 shadow-sm flex flex-col gap-2 min-w-[260px] max-w-[320px]"},oo={class:"flex items-center gap-3 mb-1"},eo={key:0,class:"absolute left-1 top-1 text-xs font-bold"},to={key:1,class:"absolute right-1 top-1 text-xs font-bold"},so={class:"text-xs text-gray-700 font-semibold"},ro=["max","step"],io={class:"text-xs text-gray-600 mt-1"},ao={key:0},no={class:"font-bold text-green-700"},lo={key:1},mo={class:"font-bold"},uo={class:"font-bold text-green-700"},po={class:"text-xs text-gray-500 mt-1"},co={class:"font-bold"},bo={class:"bg-gray-50 rounded-2xl p-4 border-2 border-green-300 shadow-sm flex flex-col gap-2 min-w-[260px] max-w-[320px]"},vo={class:"flex items-center gap-3 mb-1"},_o={key:0,class:"absolute left-1 top-1 text-xs font-bold"},xo={key:1,class:"absolute right-1 top-1 text-xs font-bold"},Co={class:"text-xs text-gray-700 font-semibold"},go=["max","step"],fo={class:"text-xs text-gray-600 mt-1"},yo={key:0},ho={class:"font-bold text-green-700"},ko={key:1},wo={class:"font-bold"},Po={class:"font-bold text-green-700"},Mo={class:"text-xs text-gray-500 mt-1"},qo={class:"font-bold"},Vo={class:"flex justify-end gap-3 mt-6"};function Fo(r,o,g,h,e,d){const b=k("BaseButton"),w=k("BaseTable");return i(),a("div",null,[t("div",B,[o[17]||(o[17]=t("div",null,[t("h2",{class:"text-2xl font-semibold text-gray-800"},"Compras"),t("p",{class:"mt-2 text-sm text-gray-500"},"Gerencie suas compras.")],-1)),t("div",R,[p(b,{class:"btn-secondary",onClick:d.loadCompras},{default:m(()=>[...o[15]||(o[15]=[n("Atualizar",-1)])]),_:1},8,["onClick"]),p(b,{class:"btn-primary",onClick:d.openCreateModal},{default:m(()=>[...o[16]||(o[16]=[n("Adicionar Compra",-1)])]),_:1},8,["onClick"])])]),e.loading||d.visibleCompras.length>0?(i(),a("div",T,[p(w,{columns:d.tableCols,rows:d.paginatedCompras},{fornecedor:m(({row:s})=>[n(l(s.fornecedor||"-"),1)]),produto:m(({row:s})=>[n(l(s.produto||"-"),1)]),quantidade:m(({row:s})=>[n(l(s.quantidade!==void 0&&s.quantidade!==null?s.quantidade:"-"),1)]),valor_unitario:m(({row:s})=>[n(l(s.valor_unitario!==void 0&&s.valor_unitario!==null?"R$ "+s.valor_unitario:"-"),1)]),status:m(({row:s})=>[n(l(s.status||"-"),1)]),_:1},8,["columns","rows"])])):u("",!0),d.visibleCompras.length===0&&!e.loading?(i(),a("div",E,[o[19]||(o[19]=t("p",{class:"text-lg font-medium mb-4 text-gray-800"},"Nenhuma compra encontrada.",-1)),o[20]||(o[20]=t("p",{class:"text-sm muted mb-6"},"Adicione compras para comeÃ§ar a registrar entradas.",-1)),t("div",S,[p(b,{class:"btn-primary",onClick:d.openCreateModal},{default:m(()=>[...o[18]||(o[18]=[n("Adicionar Compra",-1)])]),_:1},8,["onClick"])])])):u("",!0),d.visibleCompras.length>0?(i(),a("div",U,[t("div",z,[t("div",j,"Mostrando "+l((e.currentPage-1)*e.pageSize+1)+" - "+l(Math.min(e.currentPage*e.pageSize,e.totalCount))+" de "+l(e.totalCount),1),t("div",A,[p(b,{class:"btn-secondary",disabled:e.currentPage<=1,onClick:d.prevPage},{default:m(()=>[...o[21]||(o[21]=[n("Anterior",-1)])]),_:1},8,["disabled","onClick"]),(i(!0),a(x,null,C(Math.min(5,d.totalPages),s=>(i(),a("button",{key:s,class:v(["px-3 py-1 rounded text-sm",{"bg-gray-200":e.currentPage===s}]),onClick:Bo=>d.goToPage(s)},l(s),11,N))),128)),p(b,{class:"btn-secondary",disabled:e.currentPage>=d.totalPages,onClick:d.nextPage},{default:m(()=>[...o[22]||(o[22]=[n("PrÃ³ximo",-1)])]),_:1},8,["disabled","onClick"])])])])):u("",!0),e.showCreateModal?(i(),a("div",Q,[t("div",{class:"fixed inset-0 bg-black/40",onClick:o[0]||(o[0]=(...s)=>d.closeCreateModal&&d.closeCreateModal(...s)),"aria-hidden":"true"}),t("div",G,[o[52]||(o[52]=t("h3",{class:"text-xl font-semibold mb-4 text-gray-800"},"Adicionar Compra",-1)),t("form",{onSubmit:o[14]||(o[14]=V((...s)=>d.createPurchase&&d.createPurchase(...s),["prevent"])),class:"space-y-5"},[t("div",null,[o[23]||(o[23]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},"Tipo de Compra",-1)),t("div",D,[t("button",{type:"button",onClick:o[1]||(o[1]=s=>e.novaCompra.tipo="revenda"),class:v(["px-4 py-2 rounded-lg border",e.novaCompra.tipo==="revenda"?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300"])},"Revenda",2),t("button",{type:"button",onClick:o[2]||(o[2]=s=>e.novaCompra.tipo="cliente"),class:v(["px-4 py-2 rounded-lg border",e.novaCompra.tipo==="cliente"?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300"])},"Cliente",2)])]),t("div",null,[o[25]||(o[25]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},"Fornecedor",-1)),c(t("select",{"onUpdate:modelValue":o[3]||(o[3]=s=>e.novaCompra.fornecedor_id=s),class:"p-3 border border-gray-300 rounded-xl estilo-select w-full",required:""},[o[24]||(o[24]=t("option",{value:null,disabled:""},"Escolha um fornecedor",-1)),(i(!0),a(x,null,C(e.fornecedores,s=>(i(),a("option",{key:s.id,value:s.id},l(s.razao_social),9,I))),128))],512),[[f,e.novaCompra.fornecedor_id,void 0,{number:!0}]])]),e.novaCompra.tipo==="cliente"?(i(),a("div",L,[o[27]||(o[27]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},"Cliente",-1)),c(t("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>e.novaCompra.cliente_id=s),class:"p-3 border border-gray-300 rounded-xl estilo-select w-full",required:""},[o[26]||(o[26]=t("option",{value:null,disabled:""},"Escolha um cliente",-1)),(i(!0),a(x,null,C(e.clientes,s=>(i(),a("option",{key:s.id,value:s.id},l(s.nome),9,H))),128))],512),[[f,e.novaCompra.cliente_id,void 0,{number:!0}]])])):u("",!0),t("div",null,[o[29]||(o[29]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},"Produto",-1)),c(t("select",{"onUpdate:modelValue":o[5]||(o[5]=s=>e.novaCompra.produto_id=s),onChange:o[6]||(o[6]=(...s)=>d.onProdutoChange&&d.onProdutoChange(...s)),class:"p-3 border border-gray-300 rounded-xl estilo-select w-full",required:""},[o[28]||(o[28]=t("option",{value:null,disabled:""},"Escolha um produto",-1)),(i(!0),a(x,null,C(e.produtos,s=>(i(),a("option",{key:s.id,value:s.id},l(s.nome),9,J))),128))],544),[[f,e.novaCompra.produto_id,void 0,{number:!0}]])]),e.novaCompra.tipo==="cliente"?(i(),a("div",K,[o[31]||(o[31]=t("label",{class:"text-sm text-gray-600 mb-1 block"},"Motorista",-1)),c(t("select",{"onUpdate:modelValue":o[7]||(o[7]=s=>e.novaCompra.motorista_id=s),class:"p-3 border border-gray-300 rounded-xl estilo-select",required:""},[o[30]||(o[30]=t("option",{value:null,disabled:""},"Escolha um motorista",-1)),(i(!0),a(x,null,C(e.motoristas,s=>(i(),a("option",{key:s.id,value:s.id},l(s.nome),9,O))),128))],512),[[f,e.novaCompra.motorista_id,void 0,{number:!0}]])])):u("",!0),t("div",W,[t("div",X,[o[32]||(o[32]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},"Quantidade",-1)),c(t("input",{"onUpdate:modelValue":o[8]||(o[8]=s=>e.novaCompra.quantidade=s),type:"number",placeholder:"Quantidade",class:"p-3 border border-gray-300 rounded-xl w-full",min:"1",required:""},null,512),[[y,e.novaCompra.quantidade,void 0,{number:!0}]])]),t("div",Y,[o[33]||(o[33]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},"Valor UnitÃ¡rio (R$)",-1)),c(t("input",{"onUpdate:modelValue":o[9]||(o[9]=s=>e.novaCompra.valor_unitario=s),type:"number",placeholder:"Valor UnitÃ¡rio",class:"p-3 border border-gray-300 rounded-xl w-full",step:"0.01",required:""},null,512),[[y,e.novaCompra.valor_unitario,void 0,{number:!0}]])])]),e.novaCompra.tipo==="cliente"?(i(),a("div",Z,[t("div",$,[o[41]||(o[41]=t("div",{class:"font-semibold text-gray-700 flex items-center gap-2 text-base mb-1"},[t("span",{class:"inline-block w-7 h-7 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mr-2 text-xl"},"ðŸ’°"),n(" ComissÃ£o IntermediaÃ§Ã£o ")],-1)),t("div",oo,[o[34]||(o[34]=t("label",{class:"text-xs text-gray-600"},"Tipo:",-1)),t("button",{type:"button",onClick:o[10]||(o[10]=s=>e.novaCompra.comissao_intermediador_em_dinheiro=!e.novaCompra.comissao_intermediador_em_dinheiro),class:v(["relative w-12 h-6 rounded-full transition-colors duration-200 focus:outline-none",e.novaCompra.comissao_intermediador_em_dinheiro?"bg-green-500":"bg-gray-300"])},[t("span",{class:v(["absolute left-0 top-0 w-6 h-6 bg-white rounded-full shadow transition-transform duration-200",e.novaCompra.comissao_intermediador_em_dinheiro?"translate-x-6":""])},null,2),e.novaCompra.comissao_intermediador_em_dinheiro?u("",!0):(i(),a("span",eo,"%")),e.novaCompra.comissao_intermediador_em_dinheiro?(i(),a("span",to,"R$")):u("",!0)],2),t("span",so,l(e.novaCompra.comissao_intermediador_em_dinheiro?"R$":"%"),1)]),c(t("input",{"onUpdate:modelValue":o[11]||(o[11]=s=>e.novaCompra.comissao_intermediador=s),type:"number",min:"0",max:e.novaCompra.comissao_intermediador_em_dinheiro?null:100,step:(e.novaCompra.comissao_intermediador_em_dinheiro,"0.01"),placeholder:"ComissÃ£o",class:"p-2 border border-blue-300 rounded-xl w-full text-base"},null,8,ro),[[y,e.novaCompra.comissao_intermediador,void 0,{number:!0}]]),t("div",io,[e.novaCompra.comissao_intermediador_em_dinheiro?(i(),a("span",ao,[o[35]||(o[35]=n(" Ganho fixo: ",-1)),t("span",no,"R$ "+l((e.novaCompra.comissao_intermediador||0).toFixed(2)),1)])):(i(),a("span",lo,[o[36]||(o[36]=n(" ComissÃ£o: ",-1)),t("span",mo,l(e.novaCompra.comissao_intermediador||0)+"%",1),o[37]||(o[37]=n()),o[38]||(o[38]=t("br",null,null,-1)),o[39]||(o[39]=n(" Valor: ",-1)),t("span",uo,"R$ "+l((e.novaCompra.quantidade*e.novaCompra.valor_unitario*(e.novaCompra.comissao_intermediador||0)/100).toFixed(2)),1)]))]),t("div",po,[o[40]||(o[40]=n(" Total para o cliente: ",-1)),t("span",co,"R$ "+l((e.novaCompra.quantidade*e.novaCompra.valor_unitario).toFixed(2)),1)])]),t("div",bo,[o[49]||(o[49]=t("div",{class:"font-semibold text-gray-700 flex items-center gap-2 text-base mb-1"},[t("span",{class:"inline-block w-7 h-7 bg-green-100 text-green-600 rounded-full flex items-center justify-center mr-2 text-xl"},"ðŸšš"),n(" ComissÃ£o Motorista ")],-1)),t("div",vo,[o[42]||(o[42]=t("label",{class:"text-xs text-gray-600"},"Tipo:",-1)),t("button",{type:"button",onClick:o[12]||(o[12]=s=>e.novaCompra.comissao_motorista_em_dinheiro=!e.novaCompra.comissao_motorista_em_dinheiro),class:v(["relative w-12 h-6 rounded-full transition-colors duration-200 focus:outline-none",e.novaCompra.comissao_motorista_em_dinheiro?"bg-green-500":"bg-gray-300"])},[t("span",{class:v(["absolute left-0 top-0 w-6 h-6 bg-white rounded-full shadow transition-transform duration-200",e.novaCompra.comissao_motorista_em_dinheiro?"translate-x-6":""])},null,2),e.novaCompra.comissao_motorista_em_dinheiro?u("",!0):(i(),a("span",_o,"%")),e.novaCompra.comissao_motorista_em_dinheiro?(i(),a("span",xo,"R$")):u("",!0)],2),t("span",Co,l(e.novaCompra.comissao_motorista_em_dinheiro?"R$":"%"),1)]),c(t("input",{"onUpdate:modelValue":o[13]||(o[13]=s=>e.novaCompra.comissao_motorista=s),type:"number",min:"0",max:e.novaCompra.comissao_motorista_em_dinheiro?null:100,step:(e.novaCompra.comissao_motorista_em_dinheiro,"0.01"),placeholder:"ComissÃ£o",class:"p-2 border border-green-300 rounded-xl w-full text-base"},null,8,go),[[y,e.novaCompra.comissao_motorista,void 0,{number:!0}]]),t("div",fo,[e.novaCompra.comissao_motorista_em_dinheiro?(i(),a("span",yo,[o[43]||(o[43]=n(" Ganho fixo: ",-1)),t("span",ho,"R$ "+l((e.novaCompra.comissao_motorista||0).toFixed(2)),1)])):(i(),a("span",ko,[o[44]||(o[44]=n(" ComissÃ£o: ",-1)),t("span",wo,l(e.novaCompra.comissao_motorista||0)+"%",1),o[45]||(o[45]=n()),o[46]||(o[46]=t("br",null,null,-1)),o[47]||(o[47]=n(" Valor: ",-1)),t("span",Po,"R$ "+l((e.novaCompra.quantidade*e.novaCompra.valor_unitario*(e.novaCompra.comissao_motorista||0)/100).toFixed(2)),1)]))]),t("div",Mo,[o[48]||(o[48]=n(" Total para o cliente: ",-1)),t("span",qo,"R$ "+l((e.novaCompra.quantidade*e.novaCompra.valor_unitario).toFixed(2)),1)])])])):u("",!0),t("div",Vo,[p(b,{type:"button",class:"btn-secondary",onClick:d.closeCreateModal},{default:m(()=>[...o[50]||(o[50]=[n("Cancelar",-1)])]),_:1},8,["onClick"]),p(b,{type:"submit",class:"btn-primary"},{default:m(()=>[...o[51]||(o[51]=[n("Adicionar Compra",-1)])]),_:1})])],32)])])):u("",!0)])}const To=P(F,[["render",Fo]]);export{To as default};
